# Vehicle Function Framework specification for Climate Control
version: "1.0"
type: "vehicle_function"

metadata:
  name: "Climate Control System"
  description: "HVAC control for vehicle cabin comfort"
  vendor: "Example Corp"
  version: "1.0.0"

signals:
  # Temperature sensors
  - path: "Vehicle.Cabin.HVAC.Station.Row1.Left.Temperature"
    type: "signal"
    datatype: "float"
    direction: "input"
    unit: "celsius"
    min: -40
    max: 80
    description: "Current cabin temperature"
    
  - path: "Vehicle.Cabin.Infotainment.HMI.TargetTemperature" 
    type: "attribute"
    datatype: "float"
    unit: "celsius"
    min: 16
    max: 32
    description: "User-set target temperature"
    
  - path: "Vehicle.Exterior.AirTemperature"
    type: "signal"
    datatype: "float"
    direction: "input"
    unit: "celsius"
    description: "Outside air temperature"
    
  # Actuators
  - path: "Vehicle.Cabin.HVAC.Station.Row1.Left.FanSpeed"
    type: "actuator"
    datatype: "uint8"
    direction: "output"
    mode: ["target", "actual"]
    min: 0
    max: 5
    description: "Fan speed level"
    
  - path: "Vehicle.Cabin.HVAC.IsAirConditioningActive"
    type: "actuator"
    datatype: "bool"
    direction: "output"
    mode: ["target", "actual"]
    description: "AC compressor state"
    
  - path: "Vehicle.Cabin.HVAC.IsHeaterActive"
    type: "actuator"
    datatype: "bool"
    direction: "output"
    mode: ["target", "actual"]
    description: "Heater state"
    
  # Control signals
  - path: "Vehicle.Cabin.HVAC.Station.Row1.Left.AirDistribution"
    type: "actuator"
    datatype: "string"
    direction: "output"
    enum_values: ["up", "middle", "down", "up_and_down"]
    description: "Air vent distribution"
    
  - path: "Vehicle.Cabin.HVAC.IsRecirculationActive"
    type: "actuator"
    datatype: "bool"
    direction: "output"
    mode: ["target", "actual"]
    description: "Air recirculation mode"
    
  # Power and mode signals
  - path: "Vehicle.Powertrain.ElectricMotor.Power"
    type: "signal"
    datatype: "float"
    direction: "input"
    unit: "kW"
    description: "Motor power output"
    
  - path: "Vehicle.Powertrain.TractionBattery.StateOfCharge.Current"
    type: "signal"
    datatype: "float"
    direction: "input"
    unit: "percent"
    min: 0
    max: 100
    description: "Battery charge level"
    
  - path: "Vehicle.Body.Windshield.Front.IsHeatingOn"
    type: "signal"
    datatype: "bool"
    direction: "input"
    description: "Defrost request signal"

requirements:
  - id: "REQ-CC-001"
    text: "The system SHALL activate cooling WHEN cabin temperature exceeds target temperature by more than 1°C"
    type: "event_driven"
    tags: ["functional", "comfort"]
    
  - id: "REQ-CC-002"
    text: "The system SHALL activate heating WHEN cabin temperature is below target temperature by more than 1°C"
    type: "event_driven"
    tags: ["functional", "comfort"]
    
  - id: "REQ-CC-003"
    text: "The system SHALL enter ECO mode WHEN battery charge is below 30%"
    type: "event_driven"
    tags: ["functional", "efficiency"]
    
  - id: "REQ-CC-004"
    text: "The system SHALL NOT start IF battery charge is below 20% AND engine is not running"
    type: "unwanted_behavior"
    tags: ["safety", "power"]
    
  - id: "REQ-CC-005"
    text: "The system SHALL prioritize defrost mode WHEN windshield heating is requested"
    type: "state_driven"
    tags: ["safety", "priority"]
    
  - id: "REQ-CC-006"
    text: "WHILE in ECO mode, the system SHALL limit fan speed to maximum 3"
    type: "state_driven"
    tags: ["efficiency", "constraint"]
    
  - id: "REQ-CC-007"
    text: "The system SHALL reach target temperature WITHIN 10 minutes under normal conditions"
    type: "temporal"
    tags: ["performance", "comfort"]

state_machines:
  - name: "ClimateControl"
    states: ["OFF", "IDLE", "COOLING", "HEATING", "DEFROST", "ECO_MODE", "ERROR"]
    initial_state: "OFF"
    transitions:
      - from: "OFF"
        to: "IDLE"
        trigger: "power_on"
        condition: "battery_level > 20 or engine_running"
        requirements: ["REQ-CC-004"]
        
      - from: "OFF"
        to: "ERROR"
        trigger: "power_on"
        condition: "battery_level <= 20 and not engine_running"
        requirements: ["REQ-CC-004"]
        
      - from: "IDLE"
        to: "COOLING"
        trigger: "start_cooling"
        condition: "temperature_difference > 1.0"
        requirements: ["REQ-CC-001"]
        
      - from: "IDLE"
        to: "HEATING"
        trigger: "start_heating"
        condition: "temperature_difference < -1.0"
        requirements: ["REQ-CC-002"]
        
      - from: "IDLE"
        to: "DEFROST"
        trigger: "defrost_requested"
        requirements: ["REQ-CC-005"]
        
      - from: "IDLE"
        to: "ECO_MODE"
        trigger: "eco_mode_requested"
        condition: "battery_level < 30"
        requirements: ["REQ-CC-003"]
        
      - from: "COOLING"
        to: "IDLE"
        trigger: "temperature_reached"
        condition: "abs(temperature_difference) < 0.5"
        
      - from: "HEATING"
        to: "IDLE"
        trigger: "temperature_reached"
        condition: "abs(temperature_difference) < 0.5"
        
      - from: "ECO_MODE"
        to: "IDLE"
        trigger: "eco_mode_cancelled"
        condition: "battery_level > 40"
        
      - from: "DEFROST"
        to: "IDLE"
        trigger: "defrost_cancelled"
        
      - from: "ERROR"
        to: "OFF"
        trigger: "error_cleared"

# Optional: AUTOSAR interface definitions
autosar_interfaces:
  - name: "ClimateToSafety"
    direction: "vehicle_to_autosar"
    signals:
      - "Vehicle.Cabin.HVAC.IsAirConditioningActive"
      - "Vehicle.Cabin.HVAC.Station.Row1.Left.FanSpeed"
    description: "Climate control outputs to safety layer"
    
  - name: "SafetyToClimate"
    direction: "autosar_to_vehicle"
    signals:
      - "Vehicle.Powertrain.TractionBattery.StateOfCharge.Current"
      - "Vehicle.Body.Windshield.Front.IsHeatingOn"
    description: "Safety layer inputs to climate control"